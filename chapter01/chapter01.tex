%!TEX root = ../clcxsj.tex

\chapter{从C走向C\#}

\section{Client/Server程序设计模式}
改变C语言中将代码写入main函数中的习惯；

改变C\#语言中将代码写入Main函数中的习惯；

改变在WinForm中直接写入代码的习惯；

以上这些习惯将带来一系列的问题，在团队开发与多人协作尤其如此，
如：不能进行unittest(单元测试)、git（著名的源代码管理工具）代码合并时会引发大量的冲突。

\section{从面向过程走向面向对象的程序设计 }

良好的面向过程设计程序设计程序是可以很好的转向面向对象的程序设计的，我们将从一个简单的
C程序开始设计结构较为良好的C代码，再将其用面向对象的C\#进行实现。从中体会面向过程与
面向对象的程序设计方法的不同。
 
 \subsection{代码示例}
 
在测绘专业中我们经常与测量点打交道，因此我们定义一个点Point（测点除了它的坐标x,y和高程z之外，还需有点名），
 另外我们定义一个简单的为大家所熟知的圆Circle，来使用点Point，并实现判断两圆是否相交，计算圆的面积和周长等功能。代码
 如下所示：

\lstinputlisting[language=C, firstline=1, lastline=40]{./chapter01/Ch01Ex01/Ch01Ex01/Ch01Ex01.cpp}
% \caption{结构化的C代码}\label{code:Ch01Ex01}

% \begin{lstlisting}[language=C]
% #include <math.h>

% typedef struct _point {
%     char name[11];
%     double x, y, z;
% }Point;
% }
% \end{lstlisting}

% \lstinputlisting{source_filename.py}
% \lstinputlisting[language=C]{Ch01Ex1.cpp}
% \lstinputlisting[language=Python, firstline=37, lastline=45]{source_filename.py}

相应的main函数测试代码如下：

\lstinputlisting[language=C, firstline=41, lastline=64]{./chapter01/Ch01Ex01/Ch01Ex01/Ch01Ex01.cpp}
% \caption{Client作用的C main函数}\label{code:Ch01Ex01main}

程序的运行结果如下：
\begin{verbatim}
Circle1 的面积 = 20106.192983
Circle1 与 Circle2 是否相交 ：是
\end{verbatim}


与以上代码相对应的C\#代码为：

\lstinputlisting[language=C]{./chapter01/Ch01Ex02/Ch01Ex02/Circle.cs}
% \caption{由C转换为C\#的示例代码}\label{code:Ch01Ex02}


相应的C\#的Main函数测试代码如下：

\lstinputlisting[language=C]{./chapter01/Ch01Ex02/Ch01Ex02/Program.cs}
% \caption{Client化的C\#Main函数}\label{code:Ch01Ex02Main}

程序的运行结果如下：
\begin{verbatim}
Circle1的面积=20106.1929829747
Circle2的面积=38013.2711084365
Circle1与Circle2是否相交:是
\end{verbatim}

\subsection{代码分析}
C语言中有 struct，在C++中对 struct 进行了扩展，其实质就是一class。
C与C++中又特别是C中，struct与指针是其根本。

类(class)是绝大多数的面向对象程序设计语言的关键词。

程序或软件的基本概念是：程序 = 数据结构 + 算法

从程序设计语言的语法角度分析，class 是 数据与函数的复合体，是符合上述程序设计原则的。

\section{ C\#程序的组织结构}

 从以上C\#示例代码可以看出，C\#是一纯面向对象语言，其组织程序的基本单位是类(class)。
 在class之外是namespace，在class内可以定义类成员(class member)和类方法(class method)。
 在method中可以定义语句。

 Visual Studio用Solution(.sln)、Project(.csproj)与File(.cs)及文件夹进行组织。其形式如下：

 Solution --1..m--Project -- 1..m--File

 一个Project对应一个Exe文件或DLL文件或其它模块，是class等的功能组合。